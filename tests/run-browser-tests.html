<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Theory App - Browser Test Suite</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .test-button:hover {
            background: #2563eb;
        }
        .console-output {
            background: #1f2937;
            color: #10b981;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
            overflow-x: auto;
            margin-top: 10px;
            max-height: 300px;
            overflow-y: auto;
        }
        .instructions {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
        }
        .header {
            text-align: center;
            color: #1f2937;
            margin-bottom: 30px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ðŸŽµ Music Theory App Test Suite</h1>
        <p>Comprehensive testing for all application functionality</p>
    </div>

    <div class="instructions">
        <h3>ðŸ“‹ Testing Instructions</h3>
        <ol>
            <li><strong>First:</strong> Open the main application in another tab (localhost:5000)</li>
            <li><strong>Then:</strong> Come back to this page and run the tests below</li>
            <li><strong>For Browser Tests:</strong> Copy the test code and run it in the main app's console</li>
            <li><strong>View Results:</strong> Check console output for detailed test results</li>
        </ol>
    </div>

    <div class="test-section">
        <h2>ðŸŽ¼ Music Theory Core Functions Test</h2>
        <p>Tests note normalization, enharmonic equivalence, scale construction, and interval building.</p>
        <button class="test-button" onclick="copyToClipboard(musicTheoryTest)">
            Copy Music Theory Test
        </button>
        <button class="test-button" onclick="runInNewWindow('Music Theory Test', musicTheoryTest)">
            Open Test Code
        </button>
        <pre class="console-output" id="music-theory-output">Click 'Copy Music Theory Test' and paste in main app console</pre>
    </div>

    <div class="test-section">
        <h2>ðŸŽ¯ Integration & User Workflow Test</h2>
        <p>Tests complete user workflows, navigation, and component interactions.</p>
        <button class="test-button" onclick="copyToClipboard(integrationTest)">
            Copy Integration Test
        </button>
        <button class="test-button" onclick="runInNewWindow('Integration Test', integrationTest)">
            Open Test Code
        </button>
        <pre class="console-output" id="integration-output">Click 'Copy Integration Test' and paste in main app console</pre>
    </div>

    <div class="test-section">
        <h2>ðŸ”Š Audio Functionality Test</h2>
        <p>Tests Web Audio API support, audio engine initialization, and piano key audio triggers.</p>
        <button class="test-button" onclick="copyToClipboard(audioTest)">
            Copy Audio Test
        </button>
        <button class="test-button" onclick="runInNewWindow('Audio Test', audioTest)">
            Open Test Code
        </button>
        <pre class="console-output" id="audio-output">Click 'Copy Audio Test' and paste in main app console</pre>
    </div>

    <div class="test-section">
        <h2>ðŸ“± Responsive Design Test</h2>
        <p>Tests viewport configuration, touch targets, and mobile-friendly design.</p>
        <button class="test-button" onclick="copyToClipboard(responsiveTest)">
            Copy Responsive Test
        </button>
        <button class="test-button" onclick="runInNewWindow('Responsive Test', responsiveTest)">
            Open Test Code
        </button>
        <pre class="console-output" id="responsive-output">Click 'Copy Responsive Test' and paste in main app console</pre>
    </div>

    <div class="test-section">
        <h2>ðŸš€ Quick Test All</h2>
        <p>Run all tests in sequence (copy and paste in main app console).</p>
        <button class="test-button" onclick="copyToClipboard(allTests)">
            Copy All Tests
        </button>
        <button class="test-button" onclick="runInNewWindow('All Tests', allTests)">
            Open All Test Code
        </button>
    </div>

    <script>
        // Test definitions
        const musicTheoryTest = \`
// Music Theory Test Suite - Run in Browser Console
(function() {
  console.log('ðŸŽ¼ Testing Music Theory Functions...');
  
  // Import the music theory functions - adjust based on how they're exposed
  const musicTheory = window.musicTheory || {};
  const { 
    normalizeNote, 
    areNotesEnharmonicallyEqual, 
    getMajorScale, 
    getMinorScale,
    buildInterval,
    INTERVAL_DEFINITIONS,
    areNotesEqual,
    normalizeNotes
  } = musicTheory;
  
  if (!normalizeNote) {
    console.error('âŒ Music theory functions not available. Make sure you are on the main app page (localhost:5000)');
    return;
  }

  let passed = 0;
  let failed = 0;
  
  function test(name, testFn) {
    try {
      testFn();
      console.log(\`âœ… \${name}\`);
      passed++;
    } catch (error) {
      console.log(\`âŒ \${name}: \${error.message}\`);
      failed++;
    }
  }
  
  function assert(condition, message) {
    if (!condition) throw new Error(message);
  }

  // Test 1: Note Normalization
  test('Note Normalization - Flats to Sharps', () => {
    assert(normalizeNote('Bb') === 'A#', 'Bb should normalize to A#');
    assert(normalizeNote('Db') === 'C#', 'Db should normalize to C#');
    assert(normalizeNote('Eb') === 'D#', 'Eb should normalize to D#');
    assert(normalizeNote('C') === 'C', 'Natural notes should remain unchanged');
  });

  // Test 2: Invalid Note Input (this should trigger the error handling)
  test('Invalid Note Input Handling', () => {
    const invalidInputs = ['Perfect', 'Perfect 5th', 'Major', 'Minor', 'Perfect Unison'];
    
    invalidInputs.forEach(input => {
      console.log(\`Testing invalid input: \${input}\`);
      const result = normalizeNote(input);
      // Should return 'C' as fallback, not crash
      assert(result === 'C', \`Invalid input \${input} should fallback to C, got \${result}\`);
    });
  });

  // Test 3: Enharmonic Equivalence
  test('Enharmonic Equivalence', () => {
    assert(areNotesEnharmonicallyEqual('Bb', 'A#'), 'Bb and A# should be enharmonically equal');
    assert(areNotesEnharmonicallyEqual('C#', 'Db'), 'C# and Db should be enharmonically equal');
    assert(!areNotesEnharmonicallyEqual('C', 'D'), 'C and D should not be enharmonically equal');
  });

  // Test 4: Scale Construction
  test('Major Scale Construction', () => {
    const cMajor = getMajorScale('C');
    const expectedNotes = ['C', 'D', 'E', 'F', 'G', 'A', 'B'];
    assert(JSON.stringify(cMajor.notes) === JSON.stringify(expectedNotes), 
           \`C Major scale incorrect. Expected: \${expectedNotes}, Got: \${cMajor.notes}\`);
           
    const gMajor = getMajorScale('G');
    assert(gMajor.notes.includes('F#'), 'G Major should contain F#');
    assert(gMajor.sharps.includes('F#'), 'G Major key signature should include F#');
  });

  // Test 5: Minor Scale Construction  
  test('Minor Scale Construction', () => {
    const aMinor = getMinorScale('A');
    const expectedNotes = ['A', 'B', 'C', 'D', 'E', 'F', 'G'];
    assert(JSON.stringify(aMinor.notes) === JSON.stringify(expectedNotes),
           \`A Minor scale incorrect. Expected: \${expectedNotes}, Got: \${aMinor.notes}\`);
  });

  // Test 6: Interval Building
  test('Interval Building', () => {
    assert(buildInterval('C', 'Perfect 5th', 'up') === 'G', 'Perfect 5th from C should be G');
    assert(buildInterval('C', 'Major 3rd', 'up') === 'E', 'Major 3rd from C should be E');
    assert(buildInterval('C', 'Perfect Octave', 'up') === 'C', 'Perfect Octave from C should be C');
  });

  // Test 7: Array Note Comparison
  test('Note Array Comparison', () => {
    const notes1 = ['C', 'E', 'G'];
    const notes2 = ['C', 'E', 'G'];
    const notes3 = ['C', 'Eb', 'G'];
    const notes4 = ['Db', 'F', 'Ab']; // Enharmonic to C# major
    const notes5 = ['C#', 'F', 'G#']; // C# major
    
    assert(areNotesEqual(notes1, notes2), 'Identical note arrays should be equal');
    assert(!areNotesEqual(notes1, notes3), 'Different note arrays should not be equal');
    
    // Test with normalization
    if (normalizeNotes) {
      const normalized4 = normalizeNotes(notes4);
      const normalized5 = normalizeNotes(notes5);
      assert(JSON.stringify(normalized4) === JSON.stringify(normalized5), 
             'Enharmonic note arrays should normalize to same result');
    }
  });

  console.log(\`\\nðŸ“Š Music Theory Test Results: \${passed} passed, \${failed} failed\`);
  
  if (failed > 0) {
    console.log('âŒ Some tests failed. Please check the issues above.');
  } else {
    console.log('âœ… All music theory tests passed!');
  }
})();
\`;

        const integrationTest = \`
// Complete User Workflow Test - Run in Browser Console
(async function testUserWorkflow() {
  console.log('ðŸŽ¯ Testing Complete User Workflow...');
  
  let passed = 0;
  let failed = 0;
  
  function test(name, testFn) {
    try {
      testFn();
      console.log(\`âœ… \${name}\`);
      passed++;
    } catch (error) {
      console.log(\`âŒ \${name}: \${error.message}\`);
      failed++;
    }
  }
  
  function assert(condition, message) {
    if (!condition) throw new Error(message);
  }

  // Test 1: Piano Keyboard Functionality
  test('Piano Keyboard - Key Presence', () => {
    const pianoKeys = document.querySelectorAll('button[class*="key"], [data-testid*="key"]');
    assert(pianoKeys.length >= 25, 'Piano should have at least 25 keys (2.5 octaves)');
    console.log(\`âœ“ Found \${pianoKeys.length} piano keys\`);
    
    // Test for both white and black keys
    const whiteKeys = Array.from(pianoKeys).filter(key => 
      key.classList.contains('white') || 
      key.style.backgroundColor === 'white' ||
      !key.classList.contains('black')
    );
    console.log(\`âœ“ Piano keyboard structure appears correct\`);
  });

  // Test 2: Navigation Between Pages
  test('Navigation - Page Elements', () => {
    const backButtons = document.querySelectorAll('[data-testid="button-back"]');
    const links = document.querySelectorAll('a[href]');
    const buttons = document.querySelectorAll('button');
    
    console.log(\`âœ“ Found \${backButtons.length} back buttons\`);
    console.log(\`âœ“ Found \${links.length} navigation links\`);
    console.log(\`âœ“ Found \${buttons.length} interactive buttons\`);
    
    assert(buttons.length > 0, 'Should have interactive buttons');
  });

  // Test 3: Progress Tracking Elements
  test('Progress Tracking - UI Elements', () => {
    const progressElements = document.querySelectorAll('[data-testid*="progress"], [class*="progress"]');
    const accuracyElement = document.querySelector('[data-testid="accuracy-percentage"]');
    
    console.log(\`âœ“ Found \${progressElements.length} progress tracking elements\`);
    
    if (accuracyElement) {
      const accuracyText = accuracyElement.textContent;
      console.log(\`âœ“ Accuracy display: \${accuracyText}\`);
    }
  });

  // Test 4: Form and Input Elements
  test('Interactive Elements - Forms and Inputs', () => {
    const forms = document.querySelectorAll('form');
    const inputs = document.querySelectorAll('input, select, textarea');
    const buttons = document.querySelectorAll('button:not([disabled])');
    
    console.log(\`âœ“ Found \${forms.length} forms\`);
    console.log(\`âœ“ Found \${inputs.length} input fields\`);
    console.log(\`âœ“ Found \${buttons.length} enabled buttons\`);
  });

  // Test 5: Page Content Structure
  test('Page Structure - Essential Elements', () => {
    const headings = document.querySelectorAll('h1, h2, h3, h4, h5, h6');
    const paragraphs = document.querySelectorAll('p');
    const lists = document.querySelectorAll('ul, ol');
    
    assert(headings.length > 0, 'Page should have headings');
    console.log(\`âœ“ Found \${headings.length} headings\`);
    console.log(\`âœ“ Found \${paragraphs.length} paragraphs\`);
    console.log(\`âœ“ Found \${lists.length} lists\`);
  });

  console.log(\`\\nðŸ“Š Integration Test Results: \${passed} passed, \${failed} failed\`);
  
  if (failed === 0) {
    console.log('âœ… All integration tests passed!');
  } else {
    console.log('âŒ Some integration tests failed. Check issues above.');
  }
})();
\`;

        const audioTest = \`
// Audio Functionality Test - Run in Browser Console  
(async function testAudio() {
  console.log('ðŸ”Š Testing Audio Functionality...');
  
  let passed = 0;
  let failed = 0;
  
  function test(name, testFn) {
    try {
      testFn();
      console.log(\`âœ… \${name}\`);
      passed++;
    } catch (error) {
      console.log(\`âŒ \${name}: \${error.message}\`);
      failed++;
    }
  }
  
  function assert(condition, message) {
    if (!condition) throw new Error(message);
  }

  // Test 1: Web Audio API Support
  test('Web Audio API Support', () => {
    const AudioContext = window.AudioContext || window.webkitAudioContext;
    assert(AudioContext, 'Web Audio API should be supported');
    console.log('âœ“ Web Audio API is available');
  });

  // Test 2: Audio Engine Availability
  test('Audio Engine Integration', () => {
    // Check various ways the audio engine might be exposed
    const audioEngine = window.audioEngine || window.musicApp?.audioEngine;
    
    if (audioEngine) {
      assert(typeof audioEngine.playNote === 'function' || typeof audioEngine.initializeAudio === 'function', 
             'Audio engine should have playback methods');
      console.log('âœ“ Audio engine found and accessible');
    } else {
      console.log('â„¹ï¸ Audio engine not found in global scope (this may be expected)');
    }
  });

  // Test 3: Audio Context Creation
  test('Audio Context Creation', () => {
    try {
      const AudioContext = window.AudioContext || window.webkitAudioContext;
      const context = new AudioContext();
      
      assert(context.createOscillator, 'Should support oscillator creation');
      assert(context.createGain, 'Should support gain node creation');
      
      context.close();
      console.log('âœ“ Audio context creation and cleanup successful');
    } catch (error) {
      throw new Error(\`Audio context test failed: \${error.message}\`);
    }
  });

  console.log(\`\\nðŸ“Š Audio Test Results: \${passed} passed, \${failed} failed\`);
})();
\`;

        const responsiveTest = \`
// Responsive Design Test - Run in Browser Console
(function testResponsive() {
  console.log('ðŸ“± Testing Responsive Design...');
  
  let passed = 0;
  let failed = 0;
  
  function test(name, testFn) {
    try {
      testFn();
      console.log(\`âœ… \${name}\`);
      passed++;
    } catch (error) {
      console.log(\`âŒ \${name}: \${error.message}\`);
      failed++;
    }
  }
  
  function assert(condition, message) {
    if (!condition) throw new Error(message);
  }

  // Test 1: Viewport Configuration
  test('Viewport Meta Tag', () => {
    const viewport = document.querySelector('meta[name="viewport"]');
    assert(viewport, 'Viewport meta tag should be present');
    
    const content = viewport.getAttribute('content');
    assert(content.includes('width=device-width'), 'Viewport should include device-width');
    console.log(\`âœ“ Viewport content: \${content}\`);
  });

  // Test 2: Touch-Friendly Design
  test('Touch Target Sizes', () => {
    const buttons = document.querySelectorAll('button, a[role="button"]');
    let goodTouchTargets = 0;
    
    buttons.forEach(btn => {
      const rect = btn.getBoundingClientRect();
      if (rect.width >= 44 && rect.height >= 44) {
        goodTouchTargets++;
      }
    });
    
    console.log(\`âœ“ \${goodTouchTargets}/\${buttons.length} buttons have good touch target size (44px+)\`);
  });

  // Test 3: CSS Layout Method
  test('Modern CSS Layout', () => {
    const elements = document.querySelectorAll('*');
    let gridElements = 0;
    let flexElements = 0;
    
    elements.forEach(el => {
      const styles = window.getComputedStyle(el);
      if (styles.display === 'grid') gridElements++;
      if (styles.display === 'flex') flexElements++;
    });
    
    console.log(\`âœ“ Found \${gridElements} CSS Grid elements\`);
    console.log(\`âœ“ Found \${flexElements} Flexbox elements\`);
    assert(gridElements > 0 || flexElements > 0, 'Should use modern CSS layout methods');
  });

  console.log(\`\\nðŸ“Š Responsive Design Results: \${passed} passed, \${failed} failed\`);
})();
\`;

        const allTests = \`
console.log('ðŸŽµ Running Complete Test Suite...');
console.log('=====================================\\n');

\${musicTheoryTest}

console.log('\\n\\n');

\${integrationTest}

console.log('\\n\\n');

\${audioTest}

console.log('\\n\\n');

\${responsiveTest}

console.log('\\n\\nðŸŽ‰ All tests completed! Check results above.');
\`;

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('Test code copied to clipboard! Paste it in the main app console.');
            }).catch(err => {
                console.error('Failed to copy: ', err);
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('Test code copied to clipboard! Paste it in the main app console.');
            });
        }

        function runInNewWindow(title, code) {
            const newWindow = window.open('', '_blank', 'width=800,height=600');
            newWindow.document.write(\`
                <html>
                <head>
                    <title>\${title}</title>
                    <style>
                        body { font-family: monospace; padding: 20px; background: #1f2937; color: #10b981; }
                        pre { white-space: pre-wrap; word-wrap: break-word; }
                        .copy-btn { background: #3b82f6; color: white; border: none; padding: 10px; border-radius: 4px; cursor: pointer; margin-bottom: 10px; }
                    </style>
                </head>
                <body>
                    <h2>\${title}</h2>
                    <button class="copy-btn" onclick="copyCode()">Copy All Code</button>
                    <pre id="code">\${code}</pre>
                    <script>
                        function copyCode() {
                            const code = document.getElementById('code').textContent;
                            navigator.clipboard.writeText(code).then(() => {
                                alert('Code copied to clipboard!');
                            });
                        }
                    </script>
                </body>
                </html>
            \`);
        }
    </script>
</body>
</html>